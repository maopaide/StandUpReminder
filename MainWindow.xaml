<Window x:Class="StandUpReminder.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        xmlns:vm="clr-namespace:StandUpReminder.ViewModels"
        Title="站立提醒助手" 
        Height="650" 
        Width="450"
        MinHeight="550"
        MinWidth="400"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanMinimize"
        ShowInTaskbar="True"
        Closing="Window_Closing"
        StateChanged="Window_StateChanged"
        Background="#F5F5F5">

	<Window.DataContext>
		<vm:MainViewModel/>
	</Window.DataContext>

	<Window.Resources>
		<!-- 主色调 -->
		<SolidColorBrush x:Key="PrimaryColor" Color="#4CAF50"/>
		<SolidColorBrush x:Key="PrimaryDarkColor" Color="#388E3C"/>
		<SolidColorBrush x:Key="AccentColor" Color="#FF9800"/>
		<SolidColorBrush x:Key="TextPrimaryColor" Color="#212121"/>
		<SolidColorBrush x:Key="TextSecondaryColor" Color="#757575"/>
		<SolidColorBrush x:Key="CardBackground" Color="#FFFFFF"/>

		<!-- 卡片样式 -->
		<Style x:Key="CardStyle" TargetType="Border">
			<Setter Property="Background" Value="{StaticResource CardBackground}"/>
			<Setter Property="CornerRadius" Value="12"/>
			<Setter Property="Padding" Value="20"/>
			<Setter Property="Margin" Value="0,0,0,15"/>
			<Setter Property="Effect">
				<Setter.Value>
					<DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.1"/>
				</Setter.Value>
			</Setter>
		</Style>

		<!-- 主按钮样式 -->
		<Style x:Key="PrimaryButtonStyle" TargetType="Button">
			<Setter Property="Background" Value="{StaticResource PrimaryColor}"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="FontSize" Value="14"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="Padding" Value="20,12"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="Cursor" Value="Hand"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border x:Name="border" 
                                Background="{TemplateBinding Background}" 
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
							<ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryDarkColor}"/>
							</Trigger>
							<Trigger Property="IsPressed" Value="True">
								<Setter TargetName="border" Property="Opacity" Value="0.9"/>
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<!-- 次要按钮样式 -->
		<Style x:Key="SecondaryButtonStyle" TargetType="Button">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="Foreground" Value="{StaticResource PrimaryColor}"/>
			<Setter Property="FontSize" Value="13"/>
			<Setter Property="Padding" Value="15,8"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="BorderBrush" Value="{StaticResource PrimaryColor}"/>
			<Setter Property="Cursor" Value="Hand"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border x:Name="border" 
                                Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
							<ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter TargetName="border" Property="Background" Value="#E8F5E9"/>
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<!-- ComboBox样式 -->
		<Style x:Key="ModernComboBoxStyle" TargetType="ComboBox">
			<Setter Property="Background" Value="#F5F5F5"/>
			<Setter Property="Padding" Value="10,8"/>
			<Setter Property="FontSize" Value="14"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="BorderBrush" Value="#E0E0E0"/>
		</Style>

		<!-- 标签样式 -->
		<Style x:Key="LabelStyle" TargetType="TextBlock">
			<Setter Property="FontSize" Value="14"/>
			<Setter Property="Foreground" Value="{StaticResource TextSecondaryColor}"/>
			<Setter Property="Margin" Value="0,0,0,8"/>
		</Style>

		<Style x:Key="ValueStyle" TargetType="TextBlock">
			<Setter Property="FontSize" Value="16"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="Foreground" Value="{StaticResource TextPrimaryColor}"/>
		</Style>
	</Window.Resources>

	<Grid>
		<!-- 系统托盘图标 -->
		<tb:TaskbarIcon x:Name="TaskbarIcon"
                        IconSource="/Resources/icon.ico"
                        ToolTipText="站立提醒助手"
                        DoubleClickCommand="{Binding}"
                        TrayLeftMouseUp="TaskbarIcon_TrayLeftMouseUp">
			<tb:TaskbarIcon.ContextMenu>
				<ContextMenu>
					<MenuItem Header="打开主界面" Click="ShowWindow_Click"/>
					<MenuItem Header="立即提醒" Command="{Binding TestNotificationCommand}"/>
					<Separator/>
					<MenuItem Header="暂停提醒" Command="{Binding StopReminderCommand}" 
                              IsEnabled="{Binding Settings.IsEnabled}"/>
					<MenuItem Header="启动提醒" Command="{Binding StartReminderCommand}"
                              IsEnabled="{Binding Settings.IsEnabled, Converter={StaticResource InverseBoolConverter}}"/>
					<Separator/>
					<MenuItem Header="退出程序" Click="Exit_Click"/>
				</ContextMenu>
			</tb:TaskbarIcon.ContextMenu>
		</tb:TaskbarIcon>

		<ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
			<StackPanel>
				<!-- 标题区域 -->
				<TextBlock Text="🧍 站立、喝水提醒助手" 
                           FontSize="28" 
                           FontWeight="Bold" 
                           Foreground="{StaticResource PrimaryColor}"
                           Margin="0,0,0,5"/>
				<TextBlock Text="保护身体，请不要久坐" 
                           FontSize="14" 
                           Foreground="{StaticResource TextSecondaryColor}"
                           Margin="0,0,0,25"/>

				<!-- 状态卡片 -->
				<Border Style="{StaticResource CardStyle}">
					<Grid>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>
						<Grid.RowDefinitions>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="Auto"/>
						</Grid.RowDefinitions>

						<!-- 状态 -->
						<StackPanel Grid.Row="0" Grid.Column="0">
							<TextBlock Text="当前状态" Style="{StaticResource LabelStyle}"/>
							<StackPanel Orientation="Horizontal">
								<Ellipse Width="12" Height="12" Margin="0,0,8,0">
									<Ellipse.Style>
										<Style TargetType="Ellipse">
											<Setter Property="Fill" Value="#F44336"/>
											<Style.Triggers>
												<DataTrigger Binding="{Binding Settings.IsEnabled}" Value="True">
													<Setter Property="Fill" Value="#4CAF50"/>
												</DataTrigger>
											</Style.Triggers>
										</Style>
									</Ellipse.Style>
								</Ellipse>
								<TextBlock Text="{Binding Status}" Style="{StaticResource ValueStyle}"/>
							</StackPanel>
						</StackPanel>

						<!-- 开关按钮 -->
						<Button Grid.Row="0" Grid.Column="1"
                                Command="{Binding ToggleReminderCommand}"
                                Style="{StaticResource PrimaryButtonStyle}"
                                VerticalAlignment="Center">
							<Button.Content>
								<TextBlock>
									<TextBlock.Style>
										<Style TargetType="TextBlock">
											<Setter Property="Text" Value="启动"/>
											<Style.Triggers>
												<DataTrigger Binding="{Binding Settings.IsEnabled}" Value="True">
													<Setter Property="Text" Value="暂停"/>
												</DataTrigger>
											</Style.Triggers>
										</Style>
									</TextBlock.Style>
								</TextBlock>
							</Button.Content>
						</Button>

						<!-- 下次提醒 -->
						<StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,20,0,0">
							<TextBlock Text="下次提醒" Style="{StaticResource LabelStyle}"/>
							<TextBlock Text="{Binding NextReminderText}" 
                                       FontSize="18" 
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource AccentColor}"/>
						</StackPanel>

						<!-- 今日完成次数 -->
						<StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,15,0,0">
							<TextBlock Text="今日站立次数" Style="{StaticResource LabelStyle}"/>
							<StackPanel Orientation="Horizontal">
								<TextBlock Text="{Binding Settings.TodayCompletedCount}" 
                                           FontSize="36" 
                                           FontWeight="Bold"
                                           Foreground="{StaticResource PrimaryColor}"/>
								<TextBlock Text=" 次" 
                                           FontSize="16" 
                                           VerticalAlignment="Bottom"
                                           Margin="0,0,0,8"
                                           Foreground="{StaticResource TextSecondaryColor}"/>
							</StackPanel>
						</StackPanel>
					</Grid>
				</Border>

				<!-- 快捷操作 -->
				<Border Style="{StaticResource CardStyle}">
					<StackPanel>
						<TextBlock Text="快捷操作" 
                                   FontSize="16" 
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,15"/>
						<!-- === 修改：记录时间输入 + 记录按钮同一行 === -->
						<StackPanel>

							<!-- 第一行：HH : mm + 记录按钮 -->
							<StackPanel Orientation="Horizontal" VerticalAlignment="Center">
								<!-- 小时 -->
								<Border CornerRadius="6"
										Background="#F5F5F5"
										BorderBrush="#DDDDDD"
										BorderThickness="1"
										Height="32"
										Width="60"
										Margin="0,0,6,0">
									<TextBox Text="{Binding RecordHourText, UpdateSourceTrigger=PropertyChanged}"
											 GotFocus="RecordTimeBox_GotFocus" LostFocus="RecordTimeBox_LostFocus"
											 Background="Transparent"
											 BorderThickness="0"
											 Padding="8,0"
											 VerticalContentAlignment="Center"
											 HorizontalContentAlignment="Center"
											 MaxLength="2"
											 ToolTip="小时(0-23)"/>
								</Border>

								<TextBlock Text=":" VerticalAlignment="Center" FontSize="16" Margin="0,0,6,0"/>

								<!-- 分钟 -->
								<Border CornerRadius="6"
										Background="#F5F5F5"
										BorderBrush="#DDDDDD"
										BorderThickness="1"
										Height="32"
										Width="60"
										Margin="0,0,10,0">
									<TextBox Text="{Binding RecordMinuteText, UpdateSourceTrigger=PropertyChanged}"
											 GotFocus="RecordTimeBox_GotFocus" LostFocus="RecordTimeBox_LostFocus"
											 Background="Transparent"
											 BorderThickness="0"
											 Padding="8,0"
											 VerticalContentAlignment="Center"
											 HorizontalContentAlignment="Center"
											 MaxLength="2"
											 ToolTip="分钟(0-59)"/>
								</Border>

								<Button Content="✅ 记录一次站立"
										Command="{Binding CompleteStandUpCommand}"
										Style="{StaticResource SecondaryButtonStyle}"
										Margin="0,0,0,0"/>
							</StackPanel>

							<!-- 第二行：其他操作 -->
							<WrapPanel Margin="0,10,0,0">
								<Button Content="🔔 测试通知"
										Command="{Binding TestNotificationCommand}"
										Style="{StaticResource SecondaryButtonStyle}"
										Margin="0,0,10,10"/>
								<Button Content="🔄 重置计数"
										Command="{Binding ResetTodayCountCommand}"
										Style="{StaticResource SecondaryButtonStyle}"
										Margin="0,0,10,10"/>
							</WrapPanel>
						</StackPanel>

					</StackPanel>
				</Border>

				<!-- 时间设置 -->
				<Border Style="{StaticResource CardStyle}">
					<StackPanel>
						<TextBlock Text="⏰ 提醒时间设置" 
                                   FontSize="16" 
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,20"/>

						<!-- 开始时间 -->
						<Grid Margin="0,0,0,15">
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="80"/>
								<ColumnDefinition Width="*"/>
							</Grid.ColumnDefinitions>
							<TextBlock Text="开始时间" 
                                       VerticalAlignment="Center"
                                       Style="{StaticResource LabelStyle}"
                                       Margin="0"/>
							<StackPanel Grid.Column="1"
                Orientation="Horizontal"
                VerticalAlignment="Center">

								<!-- 小时，下拉圆角 -->
								<Border CornerRadius="6"
                Background="#F5F5F5"
                BorderBrush="#DDDDDD"
                BorderThickness="1"
                Height="32"
                Width="70"
                Margin="0,0,4,0">
									<ComboBox ItemsSource="{Binding Hours}"
                      SelectedItem="{Binding StartHour}"
                      Background="Transparent"
                      BorderThickness="0"
                      Padding="8,0"
                      VerticalContentAlignment="Center"/>
								</Border>

								<TextBlock Text=" : "
                   VerticalAlignment="Center"
                   FontSize="16"
                   Margin="4,0"/>

								<!-- 分，下拉圆角 -->
								<Border CornerRadius="6"
										Background="#F5F5F5"
										BorderBrush="#DDDDDD"
										BorderThickness="1"
										Height="32"
										Width="70"
										Margin="4,0,0,0">
									<ComboBox ItemsSource="{Binding Minutes}"
											  SelectedItem="{Binding StartMinute}"
											  Background="Transparent"
											  BorderThickness="0"
											  Padding="8,0"
											  VerticalContentAlignment="Center"/>
								</Border>
							</StackPanel>
						</Grid>

						<!-- 结束时间 -->
						<Grid Margin="0,0,0,15">
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="80"/>
								<ColumnDefinition Width="*"/>
							</Grid.ColumnDefinitions>
							<TextBlock Text="结束时间" 
                                       VerticalAlignment="Center"
                                       Style="{StaticResource LabelStyle}"
                                       Margin="0"/>
							<StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
								<Border CornerRadius="6"
										Background="#F5F5F5"
										BorderBrush="#DDDDDD"
										BorderThickness="1"
										Height="32"
										Width="70"
										Margin="0,0,4,0">
									<ComboBox ItemsSource="{Binding Hours}"
											  SelectedItem="{Binding EndHour}"
											  Background="Transparent"
											  BorderThickness="0"
											  Padding="8,0"
											  VerticalContentAlignment="Center"/>
								</Border>

								<TextBlock Text=" : "
										   VerticalAlignment="Center"
										   FontSize="16"
										   Margin="4,0"/>

								<Border CornerRadius="6"
										Background="#F5F5F5"
										BorderBrush="#DDDDDD"
										BorderThickness="1"
										Height="32"
										Width="70"
										Margin="4,0,0,0">
									<ComboBox ItemsSource="{Binding Minutes}"
											  SelectedItem="{Binding EndMinute}"
											  Background="Transparent"
											  BorderThickness="0"
											  Padding="8,0"
											  VerticalContentAlignment="Center"/>
								</Border>
							</StackPanel>
						</Grid>

						<!-- 提醒间隔 -->
						<Grid>
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="80"/>
								<ColumnDefinition Width="*"/>
							</Grid.ColumnDefinitions>
							<TextBlock Text="提醒间隔" 
                                       VerticalAlignment="Center"
                                       Style="{StaticResource LabelStyle}"
                                       Margin="0"/>
							<StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
								<Border CornerRadius="6"
										Background="#F5F5F5"
										BorderBrush="#DDDDDD"
										BorderThickness="1"
										Height="32"
										Width="80"
										Margin="0,0,4,0">
									<ComboBox ItemsSource="{Binding IntervalOptions}"
											  SelectedItem="{Binding Settings.IntervalMinutes}"
											  Background="Transparent"
											  BorderThickness="0"
											  Padding="8,0"
											  VerticalContentAlignment="Center"/>
								</Border>
								<TextBlock Text=" 分钟"
										   VerticalAlignment="Center"
										   Margin="4,0,0,0"/>
							</StackPanel>
						</Grid>
					</StackPanel>
				</Border>

				<!-- 今日站立时间表 - 新增 -->
				<Border Style="{StaticResource CardStyle}">
					<StackPanel>
						<TextBlock Text="🏃‍ 今日站立时间表" 
							   FontSize="16" 
							   FontWeight="SemiBold" 
							   Foreground="#333333"
							   Margin="0,0,0,20"/>

						<ItemsControl ItemsSource="{Binding StandRecords}" MaxHeight="120">
							<ItemsControl.ItemsPanel>
								<ItemsPanelTemplate>
									<WrapPanel />
								</ItemsPanelTemplate>
							</ItemsControl.ItemsPanel>
							<ItemsControl.ItemTemplate>
								<DataTemplate>
									<Border Background="#D4EDDA" 
										CornerRadius="6" 
										Padding="12,8" 
										Margin="0,0,8,8">
										<StackPanel Orientation="Horizontal">
											<!-- 勾号，绿色 -->
											<TextBlock Text="✅"
                               FontSize="13"
                               Margin="0,0,4,0"
                               Foreground="#155724"/>
											<!-- 时间文本，绿色 -->
											<TextBlock Text="{Binding}"
                               FontSize="13"
                               Foreground="#155724"/>
										</StackPanel>
									</Border>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>

						<!-- 无记录时显示 -->
						<TextBlock Text="暂无站立记录" 
							   FontSize="12" 
							   Foreground="#999999"
							   Visibility="{Binding StandRecords.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=inverse}">
							<TextBlock.Style>
								<Style TargetType="TextBlock">
									<Setter Property="Visibility" Value="Collapsed"/>
									<Style.Triggers>
										<DataTrigger Binding="{Binding StandRecords.Count}" Value="0">
											<Setter Property="Visibility" Value="Visible"/>
										</DataTrigger>
									</Style.Triggers>
								</Style>
							</TextBlock.Style>
						</TextBlock>
					</StackPanel>
				</Border>

				<!-- 今日提醒时间表 -->
				<Border Style="{StaticResource CardStyle}">
					<StackPanel>
						<TextBlock Text="📋 今日提醒时间表" 
                                   FontSize="16" 
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,15"/>
						<ItemsControl ItemsSource="{Binding TodaySchedule}">
							<ItemsControl.ItemsPanel>
								<ItemsPanelTemplate>
									<WrapPanel/>
								</ItemsPanelTemplate>
							</ItemsControl.ItemsPanel>
							<ItemsControl.ItemTemplate>
								<DataTemplate>
									<Border Background="#F5F5F5" 
                                            CornerRadius="6" 
                                            Padding="12,8" 
                                            Margin="0,0,8,8">
										<TextBlock Text="{Binding}" FontSize="13"/>
									</Border>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
					</StackPanel>
				</Border>


				<!-- 版本信息 -->
				<TextBlock Text="v1.0.0 - 保持健康，从站起来开始 💪" 
                           HorizontalAlignment="Center"
                           FontSize="12"
                           Foreground="{StaticResource TextSecondaryColor}"
                           Margin="0,10,0,20"/>
			</StackPanel>
		</ScrollViewer>
	</Grid>
</Window>
